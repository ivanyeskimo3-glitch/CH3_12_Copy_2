{% extends "base.html" %}

{% block title %}
<title>學生資料管理系統</title>

<!-- Bootstrap CSS -->
<link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
    rel="stylesheet"
>

<style>
    h1, h2 {
        text-align: center;
    }
    .head_content {
        margin-bottom: 30px;
    }
    table {
        font-size: 15px;
    }
    th {
        background-color: #f2f2f2;
    }
    .search-box {
        max-width: 400px;
        margin: 0 auto;
    }
</style>
{% endblock %}

{% block content %}
<div class="container mt-4">

    <div class="head_content">
        <h1>學生資料管理系統</h1>
        <h2 class="mt-3">
            目前的資料筆數: {{ data_count }}
            <a href="/post/" class="btn btn-primary btn-sm ms-3">新增學生資料</a>
        </h2>

        <div class="search-box mt-4">
            <form action="/index/" method="get" class="input-group">
                <input type="search" id="site_search" name="site_search"
                    value="{{ site_search }}"
                    placeholder="輸入關鍵字..."
                    class="form-control"
                >
                <button class="btn btn-secondary" type="submit">搜尋</button>
            </form>
        </div>
    </div>

    {% if status %}
    <!-- 資料表格 -->
    <div class="table-responsive mt-4">
        <table class="table table-bordered table-hover align-middle text-center">
            <thead class="table-light">
                <tr>
                    <th>學號</th>
                    <th>姓名</th>
                    <th>性別</th>
                    <th>生日</th>
                    <th>信箱</th>
                    <th>電話</th>
                    <th>地址</th>
                    <th style="width: 120px">操作</th>
                </tr>
            </thead>
            <tbody>
                {% for data in page_obj %}
                <tr>
                    <td>{{data.cID}}</td>
                    <td>{{data.cName}}</td>
                    <td>{% if data.cSex == "M" %} 男 {% else %} 女 {% endif %}</td>
                    <td>{{ data.cBirthday|date:"Y-m-d" }}</td>
                    <td>{{data.cEmail}}</td>
                    <td>{{data.cPhone}}</td>
                    <td class="text-start">{{data.cAddr}}</td>
                    <td>
                        <a href="/edit/{{ data.cID }}/" class="btn btn-warning btn-sm">編輯</a>
                        <a href="/delete/{{ data.cID }}/" class="btn btn-danger btn-sm">刪除</a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>

    <!-- 分頁 -->
    <nav>
        <ul class="pagination justify-content-center">

            {% if page_obj.has_previous %}
            <li class="page-item">
                <a class="page-link" href="?page=1{% if site_search %}&site_search={{ site_search }}{% endif %}">
                    最前頁
                </a>
            </li>

            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.previous_page_number }}{% if site_search %}&site_search={{ site_search }}{% endif %}">
                    上一頁
                </a>
            </li>
            {% endif %}

            {% for num in page_obj.paginator.page_range %}
                <li class="page-item {% if page_obj.number == num %}active{% endif %}">
                    <a class="page-link" href="?page={{ num }}{% if site_search %}&site_search={{ site_search }}{% endif %}">{{ num }}</a>
                </li>
            {% endfor %}

            {% if page_obj.has_next %}
            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.next_page_number }}{% if site_search %}&site_search={{ site_search }}{% endif %}">
                    下一頁
                </a>
            </li>

            <li class="page-item">
                <a class="page-link" href="?page={{ page_obj.paginator.num_pages }}{% if site_search %}&site_search={{ site_search }}{% endif %}">
                    最後頁
                </a>
            </li>
            {% endif %}

        </ul>
    </nav>

    {% else %}
        <h1 class="text-center text-danger">{{ errormessage }}</h1>
    {% endif %}
</div>

{% endblock %}
